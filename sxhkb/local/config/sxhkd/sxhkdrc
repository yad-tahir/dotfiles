# Copyright (C) 2019

# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301, USA.


##
## General keybindings
##

# Reload sxhkd's configuration file
super + shift + r
	pkill -USR1 -x sxhkd

# Close and kill
super + {_,shift +}q
	bspc node -{c,k}

# Close and kill marked nodes
super + ctrl + {_,shift +}q
	bspc query -N -n .marked | xargs -n 1 -I % bspc node % -{c,k}

# Swap
super + s
	bspc node newest.focused.local -s biggest.local

# Swap with the last marked node, then remove the mark
super + shift + s
	bspc node last.marked -s focused.local; bspc node last.marked -f; bspc node focused.marked -g marked

# Swap with the last marked node
super + ctrl + s
	bspc node last.marked -s focused.local; bspc node last.marked -f

# Balance the selected nodes.
super + equal
	bspc node -B

super + shift + equal
	sh -c 'fwid=$(bspc query -N -n focused.local); bspc node any.local -f && bspc node -B && bspc node $fwid -f'

# Rotate and flip
super r
	bspc node -R -90

super {_,shift +} v
	bspc node {-F vertical,-F horizontal}

# Send to a desktop
super + shift + {1-9,0}
	bspc  node -d '{1-9,10}' --follow

# Send marked nodes to a desktop
super + ctrl + {1-9,0}
	bspc query -N -n .marked | xargs -n 1 -I % bspc node % -d '{1-9,10}'

##
## State/flags
##

# Toggle between various display modes
super + Return
	{bspc config top_padding 0, bspc desktop -l monocle, bspc  desktop -l tiled; bspc config top_padding 35}

# Toggle the floating mode
super + @space
	bspc node -t '~{floating,tiled}'

# Set node flags
super + {m,f,l,x}
	bspc node -g {marked,private,locked,sticky}

##
## Focus
##

# Focus node
super + {_,shift + }{h,t,c,n}
	bspc node -{f,s} {west,south,north,east}

super + {a,b}
	bspc node -f @{parent,brother}

super + {_,shift + }Tab
	bspc node -f {next,prev}.local

super + quoteright
	bspc node -f next.marked

super + shift + quoteright
	bspc node -f next.!marked

super + ctrl + quoteright
	bspc query -N -n .marked | xargs -n 1 -I % bspc node % -g marked

super + {1-9,0}
	bspc desktop -f '{1-9,10}'

super + bracket{left,right}
	bspc desktop -f {prev,next}.local

##
## Preselect
##

# Preselect the direction.
super + minus
	bspc node -p {south,east}

# Cancel the preselection
super + shift + minus
	bspc node -p cancel

# Preselect the ratio.
super + alt + {1-9}
	bspc node -o 0.{1-9}


##
## Move/resize
##

# expand a window by moving one of its side outward.
super + {Left,Up,Down,Right}
	bspc node -z {left -20 0,top 0 -20,top 0 20,left 20 0}

super + shift + {Left,Up,Down,Right}
	bspc node -z {right -20 0,bottom 0 -20,bottom 0 20,right 20 0}


##
## Media control
##

XF86AudioMute
	pulsemixer --set-volume {0,20} --color 0 &

{XF86AudioRaiseVolume,XF86AudioLowerVolume}
	pulsemixer --change-volume {+5,-5} --color 0 &

XF86AudioPlay
	emacsclient -nqe '(do-music-toggle)' > /dev/null

XF86AudioNext
	emacsclient -nqe '(do-music-next)' > /dev/null

XF86AudioPrev
	emacsclient -nqe '(do-music-previous)' > /dev/null

{XF86AudioNext,XF86AudioPrev} + shift
	mpc seek {+00,-00}10 > /dev/null

##
## Program launcher
##

# Emacs
F2
	emacsclient -nqe "(do-make-frame nil \"$DISPLAY\")" -a='/usr/bin/urxvt -e nano' > /dev/null &

# Screen brightness
F12
	xrandr --output eDP-1 --brightness {0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1}

# Dmenu
super + g
	~/bin/dmenu/run.sh

super + e
	~/bin/dmenu/emacs.sh

super + p
	~/bin/dmenu/pass.sh

super + u
	~/bin/dmenu/monitor.sh

# Screenshot
super + F3
	scrot &

# Terminal
super + Escape
	urxvtc &

# Screen lock
super + shift + Escape
	~/bin/screen-lock &

# Bar
Print
	{killall polybar; bspc config top_padding 0, bspc config top_padding "$(xrdb -query | awk '/\Panel.height:/\{print $2\}')"; bspc query -M --names | xargs -I % -n 1 sh -c 'MONITOR=% polybar orange &'} &

# Dvorak or Qwerty
alt + space
	~/bin/keyboard-toggle
